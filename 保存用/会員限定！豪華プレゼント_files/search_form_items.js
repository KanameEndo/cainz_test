$((function(){const isDog=$("#search-form-202110_popup").attr("name");const formId=isDog!=="true"?"#form2_BreederSearchForm":"#form1_DogSearchForm";if($("#preferential_birth_m").length){$("#preferential_birth_m")[0].selectedIndex=$("#preferential_birth_m").attr("value");$("#preferential_birth_d")[0].selectedIndex=$("#preferential_birth_d").attr("value")}filterDogBreeds();refreshSelectedBreedsCount();setColorDisplay();removeFromForm();$(".breed_clear").off("click");$(".breed_clear").click((function(event){clearBreedsCondition();hideColorScope();refreshSearchResultCount(formId);event.stopPropagation()}));$(".commitment_clear").off("click");$(".commitment_clear").click((function(event){clearSpecialCondition();refreshSearchResultCount(formId);event.stopPropagation()}));$(".button_reset").off("click");$(".button_reset").click((function(){clearAllCondition();refreshSearchResultCount(formId)}));$("ul.dogbreed_tab li").off("click");$("ul.dogbreed_tab li").click((function(){$('input[name="dog-breed_select_category[]"]').map((function(){$(this).prop("checked",false)}));$(this).children("input").prop("checked",true);$(this).children("input").parent().parent().children().removeClass("select");$(this).children("input").parent().addClass("select");filterDogBreeds()}));$("#DogSearchSortN").off("change");$("#DogSearchSortN").change((function(){sortDogBreeds()}));const beforeColor=function(callback){$('input[name="dc_id[]"]').parent("li").show();$('input[name="dcc_id[]"]').parent("li").show();let dogBreedCheckboxNameChecked='input[name="db_id[]"]:checked';let breedIds=$(dogBreedCheckboxNameChecked).map((function(){return $(this).val()})).get();setDogBreedCategories(breedIds);callback()};$("body").off("click").on("click",'input[name="db_id[]"]',(function(){$("#form1_preferential_dog-size1").prop("checked",false);$("#form1_preferential_dog-size2").prop("checked",false);$("#form1_preferential_dog-size3").prop("checked",false);$("#form1_preferential_dog-size4").prop("checked",false);$("#form1_preferential_dog-breed1").prop("checked",false);beforeColor((function(){setColorDisplay()}));refreshSelectedBreedsCount();refreshSearchResultCount(formId)}));$('input[name="special_dog[]"]').off("change");$('input[name="special_dog[]"]').change((function(){refreshSearchResultCount(formId)}));$('input[name="special_breeder[]').off("change");$('input[name="special_breeder[]"]').change((function(){refreshSearchResultCount(formId)}));$(".pref_submit").click((function(){removeFromForm(formId);appendToForm(formId);$(formId).submit();$(".loading_wrap").show()}));if($("#preferential_birth_m").length){$("#preferential_birth_m").off("change");$("#preferential_birth_m").change((function(){adjustToLastDay();refreshSearchResultCount(formId)}));$("#preferential_birth_d").off("change");$("#preferential_birth_d").change((function(){adjustToLastDay();refreshSearchResultCount(formId)}))}$(document).on("change",".dog_sort",(function(){$("#form1_sort_n").val($(this).val());$("#form1_DogSearchForm").submit()}));$(document).on("change",".breeder_sort",(function(){$("#form2_sort").val($(this).val());$("#form2_BreederSearchForm").submit()}));$(".pref_all").off("click");$(".pref_all").click((function(event){$(".pref_checkbox").prop("checked",false);$(".selected-prefectures").html('<span class="selected_items">すべて</span>');$(".selected-prefectures_ids_text").val("");refreshSearchResultCount(formId);event.stopPropagation()}));$(".region").click((function(){$(this).parent().next("td").find("input[type=checkbox]").prop("checked",this.checked)}));$(".pref_checkbox").off("click");$(".pref_checkbox").click((function(){const checkboxName='[class="region pref_checkbox pref_checkbox"]:checked';$(".selected-prefectures_ids_text").val("");let prefIds=$(checkboxName).map((function(){return $(this).val()})).get();setRegions(prefIds);refreshSearchResultCount(formId)}));$('input[name="dcc_id[]"]').off("click");$('input[name="dcc_id[]"]').click((function(){let isChecked=$(this).prop("checked");let color=$(this).val();setColorCategoryCheckedToColor(color,isChecked);refreshSearchResultCount(formId)}));$('input[name="dc_id[]"]').off("click");$('input[name="dc_id[]"]').click((function(){refreshSearchResultCount(formId)}));$('input[name="dc_id[]"]').off("change");$('input[name="dc_id[]"]').change((function(){refreshSearchResultCount(formId)}));$('input[name="ss_id[]"]').off("click");$('input[name="ss_id[]"]').click((function(){refreshSearchResultCount(formId)}));$('input[name="sex[]"]').off("click");$('input[name="sex[]"]').click((function(){refreshSearchResultCount(formId)}));$('input[name="to[]"]').off("click");$('input[name="to[]"]').click((function(){refreshSearchResultCount(formId)}));if($("#preferential_price_min").length){$("#preferential_price_min").off("change");$("#preferential_price_min").change((function(){refreshSearchResultCount(formId)}))}if($("#preferential_price_max").length){$("#preferential_price_max").off("change");$("#preferential_price_max").change((function(){refreshSearchResultCount(formId)}))}$(".input_breeder_name").off("keyup");$(".input_breeder_name").keyup((function(){refreshSearchResultCount(formId)}));$(".input_breeder_name").off("change");$(".input_breeder_name").change((function(){refreshSearchResultCount(formId)}));$("#preferential_keyword").off("keyup");$("#preferential_keyword").keyup((function(){filterDogBreeds()}));$("#preferential_keyword").off("keydown");$("#preferential_keyword").keydown((function(){filterDogBreeds()}));$("#preferential_keyword").off("keypress");$("#preferential_keyword").keypress((function(){filterDogBreeds()}));$("#preferential_keyword").off("change");$("#preferential_keyword").change((function(){filterDogBreeds()}));$(".top_form_popup-modal").magnificPopup({type:"inline",preloader:false,callbacks:{close:function(){$("body").removeClass("popup_form-content_bg")}}});$(".form1_popup-modal").magnificPopup({type:"inline",preloader:false});$(".form2_popup-modal").magnificPopup({type:"inline",preloader:false});$(".form3_popup-modal").magnificPopup({type:"inline",preloader:false});$(document).on("click",".top_form_popup-modal",(function(){$(".modal_lazy_load").each((function(){var img=$(this);img.attr("src",img.data("src"))}));$("body").addClass("popup_form-content_bg")}));$(document).on("click",".form1_popup-modal",(function(){$("body").addClass("popup_form-content_bg")}));$(document).on("click",".form2_popup-modal",(function(){$("body").addClass("popup_form-content_bg")}));$(document).on("click",".form3_popup-modal",(function(){$("body").addClass("popup_form-content_bg")}));$(document).on("click",".popup-modal-dismiss",(function(e){$("body").removeClass("popup_form-content_bg");e.preventDefault();$.magnificPopup.close()}))}));function clearAllCondition(){$('input[name="db_id[]"]').prop("checked",false);$('input[name="dc_id[]"]').prop("checked",false);$('input[name="dcc_id[]"]').prop("checked",false);$('input[name="ss_id[]"]').prop("checked",false);$('input[id="form1_sex"]').prop("checked",true);$('input[id="form1_to_all"]').prop("checked",true);$('input[name="special_dog[]"]').prop("checked",false);$('input[name="special_breeder[]"]').prop("checked",false);$(".region").prop("checked",false);$(".input_breeder_name").val("");$('option[name="min_val"]:selected').prop("selected",false);$('option[name="max_val"]:selected').prop("selected",false);$('option[name="birth_m_val"]:selected').prop("selected",false);$('option[name="birth_d_val"]:selected').prop("selected",false);$('[data-name="dogbreed_data"]').children("input").prop("checked",false);$(".selected_count_val").text(0);$('input[name="search_word_for_breeds"]').val("");$('input[name="dog-breed_select_category[]"').prop("checked",false);$('input[id="select_all"]').prop("checked",true);$('input[id="select_all"]').parent().parent().children().removeClass("select");$('input[id="select_all"]').parent().addClass("select");filterDogBreeds();setColorDisplay()}function clearBreedsCondition(){$('[data-name="dogbreed_data"]').children("input").prop("checked",false);$(".selected_count_val").text(0);$('input[name="search_word_for_breeds"]').val("");$('input[name="dog-breed_select_category[]"').prop("checked",false);$('input[id="select_all"]').prop("checked",true);$('input[id="select_all"]').parent().parent().children().removeClass("select");$('input[id="select_all"]').parent().addClass("select");filterDogBreeds();setColorDisplay()}function clearSpecialCondition(){$('[name="special_dog[]"]').prop("checked",false)}function filterDogBreeds(){let inputKeyword=$("#preferential_keyword").val();let selectedSize=$('input[name="dog-breed_select_category[]"]:checked').val();$("ul.breed_column_group li").each((function(){$(this).show();if(inputKeyword!==""){let isMatchInputKeyword=Boolean($(this).find(".checkbox_style3:contains('"+inputKeyword+"')").length);if(!isMatchInputKeyword){$(this).hide()}}if(selectedSize!=="all"){let isMatchSelectedSize=Boolean($(this).data("sizename")===selectedSize);if(!isMatchSelectedSize){$(this).hide()}}}));sortDogBreeds()}function sortDogBreeds(){let sortNum=$("#DogSearchSortN").val();let $sortedBreeds=null;switch(sortNum){case"":$sortedBreeds=$("ul.breed_column_group li").sort((function(x,y){return $(x).data("reading-num")>$(y).data("reading-num")?1:-1})).sort((function(x,y){return $(x).data("ranking")<$(y).data("ranking")?1:-1}));$("ul.ranking_column_group").html($sortedBreeds);$("ul.ranking_column_group").show();$("div.dogbreedlist_caption").each((function(){$(this).hide();$(this).next("ul").hide()}));break;case"1":case"2":let $prefixSortedCaptionsDiv=null;let $prefixSortedCaptionsUl=null;if(sortNum==="1"){$sortedBreeds=$("ul.breed_column_group li").sort((function(x,y){return $(x).data("reading-num")>$(y).data("reading-num")?1:-1}));$prefixSortedCaptionsDiv=$("div.dogbreedlist_caption").sort((function(x,y){return $(x).data("prefix")>$(y).data("prefix")?1:-1}));$prefixSortedCaptionsUl=$("ul.reading_column_group").sort((function(x,y){return $(x).data("prefix")>$(y).data("prefix")?1:-1}))}else{$sortedBreeds=$("ul.breed_column_group li").sort((function(x,y){return $(x).data("reading-num")<$(y).data("reading-num")?1:-1}));$prefixSortedCaptionsDiv=$("div.dogbreedlist_caption").sort((function(x,y){return $(x).data("prefix")<$(y).data("prefix")?1:-1}));$prefixSortedCaptionsUl=$("ul.reading_column_group").sort((function(x,y){return $(x).data("prefix")<$(y).data("prefix")?1:-1}))}let prefix=null;let showBreedsCount=0;let isShowCaption=false;let $readingNumSortedBreedsByPrefix=null;$($prefixSortedCaptionsUl).each((function(index){prefix=$(this).data("prefix");$readingNumSortedBreedsByPrefix=$sortedBreeds.filter((function(index,element){return $(element).data("prefix")===prefix}));$(this).html($readingNumSortedBreedsByPrefix);showBreedsCount=$(this).children('li[style!="display: none;"]').length;isShowCaption=Boolean(showBreedsCount>0);if(isShowCaption){$(this).show();$($prefixSortedCaptionsDiv[index]).show()}else{$(this).hide();$($prefixSortedCaptionsDiv[index]).hide()}}));let $tempSortedBreedsDom=[];$tempSortedBreedsDom.push($("ul.ranking_column_group"));for(let i=0;i<$($prefixSortedCaptionsDiv).length;i++){$tempSortedBreedsDom.push($prefixSortedCaptionsDiv[i]);$tempSortedBreedsDom.push($prefixSortedCaptionsUl[i])}$("div.dogbreedlist").html($tempSortedBreedsDom);$("ul.ranking_column_group").hide();break}}function refreshSelectedBreedsCount(){let selectedBreedsCount=$('input[name="db_id[]"]:checked').length;$(".selected_count_val").text(selectedBreedsCount)}function adjustToLastDay(){let selectedDay=$("#preferential_birth_d")[0].selectedIndex;let selectedMonth=$("#preferential_birth_m")[0].selectedIndex;let adjustMonth=[2,4,6,9,11];if(selectedDay>29&&adjustMonth.indexOf(selectedMonth)>=0){if(selectedMonth===2){$("#preferential_birth_d")[0][30].disabled=true;$("#preferential_birth_d")[0][31].disabled=true;$("#preferential_birth_d")[0].selectedIndex=29}else{$("#preferential_birth_d")[0][30].disabled=false;$("#preferential_birth_d")[0][31].disabled=true;$("#preferential_birth_d")[0].selectedIndex=30}}else{$("#preferential_birth_d")[0][30].disabled=false;$("#preferential_birth_d")[0][31].disabled=false}}function setRegions(checkIds){var regionKeys={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1};var region1=["2","3","4","5","6","7"];var region2=["8","9","10","11","12","13","14"];var region3=["15","16","17","18","19","20","21","22","23","24"];var region4=["25","26","27","28","29","30"];var region5=["31","32","33","34","35"];var region6=["36","37","38","39"];var region7=["40","41","42","43","44","45","46","47"];if(checkIds.indexOf("1")==-1){regionKeys["0"]=null}region1.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["1"]=null}}));region2.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["2"]=null}}));region3.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["3"]=null}}));region4.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["4"]=null}}));region5.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["5"]=null}}));region6.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["6"]=null}}));region7.forEach((function(val){if(checkIds.indexOf(val)==-1){regionKeys["7"]=null}}));var formRegionId1="#form1_region";var formRegionId2="#form2_region";var formRegionId3="#form3_region";Object.keys(regionKeys).forEach((function(key){if(regionKeys[key]===1){$(formRegionId1+key).prop("checked",true);$(formRegionId2+key).prop("checked",true);$(formRegionId3+key).prop("checked",true)}else if(regionKeys[key]===null){$(formRegionId1+key).prop("checked",false);$(formRegionId2+key).prop("checked",false);$(formRegionId3+key).prop("checked",false)}}))}function setDogBreedCategories(dbIds){var categoryIds={20:1,18:1,42:1,13:1,6:1,37:1};var category1=["20","130","131"];var category2=["18","146","147"];var category3=["42","132","133","134","135","136","137","138","139","140","141","142","157","158","162","164"];var category4=["13","50"];var category5=["6","143","144","145"];var category6=["37","148","149","150"];var categorySingle=["30","34","39","35","36","24","11","16","7","25","27","31","33","10","5"];category1.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["20"]=null}}));category2.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["18"]=null}}));category3.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["42"]=null}}));category4.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["13"]=null}}));category5.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["6"]=null}}));category6.forEach((function(val){if(dbIds.indexOf(val)==-1){categoryIds["37"]=null}}));var formBreedAllId1="#form1_breeds_all_";var formBreedAllId2="#form2_breeds_all_";var formBreedAllId3="#form3_breeds_all_";var formSingleBreed1="#form1_popular";var formSingleBreed2="#form2_popular";var formSingleBreed3="#form3_popular";categorySingle.forEach((function(val){if(dbIds.indexOf(val)>=0){$(formSingleBreed1+val).prop("checked",true);$(formSingleBreed2+val).prop("checked",true);$(formSingleBreed3+val).prop("checked",true)}else if(dbIds.indexOf(val)==-1){$(formSingleBreed1+val).prop("checked",false);$(formSingleBreed2+val).prop("checked",false);$(formSingleBreed3+val).prop("checked",false)}}));Object.keys(categoryIds).forEach((function(key){if(categoryIds[key]===1){$(formBreedAllId1+key).prop("checked",true);$(formBreedAllId2+key).prop("checked",true);$(formBreedAllId3+key).prop("checked",true)}else if(categoryIds[key]===null){$(formBreedAllId1+key).prop("checked",false);$(formBreedAllId2+key).prop("checked",false);$(formBreedAllId3+key).prop("checked",false)}}))}function setColorDisplay(){$('input[name="dc_id[]"]').parent("li").hide();$('input[name="dcc_id[]"]').parent("li").hide();let colorCategoryIds=[];let count=0;let countColor=0;let colors=[];$(".search_dog_breed_id:checked").map((function(){let tmpColors=$(this).parent("li").data("dogbreedcolors");colors=colors.concat(String(tmpColors).split(","));let uniqueColors=colors.filter((function(x,i,self){return self.indexOf(x)===i}));let countSet=getCountColorItems(countColor,colorCategoryIds,uniqueColors);countColor=countSet[0];colorCategoryIds=countSet[1].filter((function(x,i,self){return self.indexOf(x)===i}));count++}));if(count===0){hideColorScope()}else{setColorsAccordionDisplay(countColor);showRelatedColors(colorCategoryIds)}}function getCountColorItems(countColor,colorCategoryIds,colors){if(colors){$.each(colors,(function(key,value){let countSet=getDogColorMap(value,countColor,colorCategoryIds);countColor=countSet[0];colorCategoryIds=countSet[1]}))}else{$(".dogcolors").map((function(){countColor++;colorCategoryIds.push($(this).data("dogcategorycolors"));$(this).show()}))}return[countColor,colorCategoryIds]}function getDogColorMap(color,countColor,colorCategoryIds){$(".dogcolors").map((function(){if($(this).data("color")==color){countColor++;colorCategoryIds.push($(this).data("dogcategorycolors"));$(this).show()}}));return[countColor,colorCategoryIds]}function setColorsAccordionDisplay(countColor){if(countColor>10){$(".inner .color_detail").hide();$(".contentTitle_style4").show()}else{$(".inner .color_detail").show();$(".contentTitle_style4").hide()}}function showRelatedColors(colorCategoryIds){$.each(colorCategoryIds,(function(key,value){$('input[name="dcc_id[]"]').map((function(){if($(this).val()==value){$(this).parent("li").show()}}))}))}function hideColorScope(){$('input[name="dc_id[]"]').parent("li").show();$('input[name="dcc_id[]"]').parent("li").show();$(".inner .color_detail").hide();$(".contentTitle_style4").show()}function setColorCategoryCheckedToColor(colorCategory,isChecked){$('input[name="dc_id[]"]').map((function(){if($(this).parent("li").data("dogcategorycolors")==colorCategory){if(isChecked===true){$(this).prop("checked",true)}else{$(this).prop("checked",false)}}}))}function appendToForm(formId,isPost=0){const isDog=$("#search-form-202110_popup").attr("name");const checkNamePost={"db_id[]":"db_id","dc_id[]":"dc_id","dcc_id[]":"dcc_id","ss_id[]":"ss_id","sex[]":"sex","to[]":"to","special_dog[]":"special_dog","special_breeder[]":"special_breeder","areas[]":"areas","p_id[]":"p_id","dog-breed_select_category[]":"dog-breed_select_category"};const checkNameGet={"db_id[]":"db_id[]","dc_id[]":"dc_id[]","dcc_id[]":"dcc_id[]","ss_id[]":"ss_id[]","sex[]":"sex[]","to[]":"to[]","special_dog[]":"special_dog[]","special_breeder[]":"special_breeder[]","areas[]":"areas[]","p_id[]":"p_id[]","dog-breed_select_category[]":"dog-breed_select_category[]"};const selectName={min_val:"min",max_val:"max",birth_m_val:"birth_m",birth_d_val:"birth_d"};let formInput="";if(headerSearchTarget==="breeder"){formInput=$(formId)}else{formInput=$("#tmpInput")}if(isPost==="1"){$.each(checkNamePost,(function(key,value){$('input[name="'+key+'"]:checked').map((function(){formInput.append('<input type="hidden" class="tmpClass" name="'+value+'" value='+$(this).val()+">")}))}))}else{$.each(checkNameGet,(function(key,value){$('input[name="'+key+'"]:checked').map((function(){formInput.append('<input type="hidden" class="tmpClass" name="'+value+'" value='+$(this).val()+">")}))}))}$.each(selectName,(function(key,value){$('option[name="'+key+'"]:selected').map((function(){formInput.append('<input type="hidden" class="tmpClass" name="'+value+'" value='+$(this).val()+">")}))}));if(isDog!=="true"){formInput.append('<input type="hidden" class="tmpClass" name="name" value='+$(".input_breeder_name").val()+">")}formInput.append('<input type="hidden" class="tmpClass" name="search_word_for_breeds" value='+$('input[name="search_word_for_breeds"]').val()+">")}function removeFromForm(formId){if(headerSearchTarget==="breeder"){$(formId).children(".tmpClass").remove()}else{$("#tmpInput").empty()}}function refreshSearchResultCount(formId){isDog=$("#search-form-202110_popup").attr("name");formId=isDog!=="true"?"#form2_BreederSearchForm":"#form1_DogSearchForm";removeFromForm(formId);appendToForm(formId,1);let data=$(formId).serializeArray();if(headerSearchTarget==="dog"){return $.ajax({type:"POST",url:"/dog/search_dog_count",data:data,async:true}).done((function(res){res!==false?$("#count").html(res):$("#count").html("-")})).fail((function(){$("#count").html("-")}))}}