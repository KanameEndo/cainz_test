$(document).ready((function(){const path=location.pathname+"?";const saveKey="conditions";const saveNames={"db_id[]":"breed","p_id[]":"pref","dcc_id[]":"dcc","dc_id[]":"color","to[]":"birthTo","sex[]":"sex","ss_id[]":"sale",max:"max",min:"min",name:"name",sort_n:"sort_n",search_word_for_breeds:"search_word_for_breeds","dog-breed_select_category[]":"dog-breed_select_category","special_dog[]":"special_dog","special_breeder[]":"special_breeder",birth_m:"birth_m",birth_d:"birth_d"};const readNames={breed:"db_id[]",pref:"p_id[]",dcc:"dcc_id[]",color:"dc_id[]",birthTo:"to[]",sex:"sex[]",sale:"ss_id[]",max:"max",min:"min",name:"name",sort_n:"sort_n",search_word_for_breeds:"search_word_for_breeds","dog-breed_select_category":"dog-breed_select_category[]",special_dog:"special_dog[]",special_breeder:"special_breeder[]",birth_m:"birth_m",birth_d:"birth_d"};function loadConditions(){var jsonObj=JSON.parse(localStorage.getItem(saveKey));var insertHtml='<div class="searchRule_set">保存している検索条件はありません</div>';if(!$.isEmptyObject(jsonObj)){insertHtml="";Object.keys(jsonObj).forEach((function(key){var conditions=[];var breeds="";var prefs="";var details="";var count=0;Object.keys(jsonObj[key]["conditions"]).forEach((function(index){conditions[count]={name:readNames[jsonObj[key]["conditions"][index]["name"]],value:jsonObj[key]["conditions"][index]["value"]};count++}));if($.isArray(jsonObj[key]["breeds"])){var breedsCount=1;var saveBreeds=jsonObj[key]["breeds"].length;jsonObj[key]["breeds"].forEach((function(val){if(breedsCount===4)return false;breeds+='<span class="selected_items">'+val+"</span>";breedsCount++}));if(saveBreeds>=4)breeds+='<span class="selected_items" style="background: none;">その他'+(saveBreeds-3)+"</span>"}if($.isArray(jsonObj[key]["prefs"])){var prefCount=1;var savePrefs=jsonObj[key]["prefs"].length;jsonObj[key]["prefs"].forEach((function(val){if(prefCount===4)return false;prefs+='<span class="selected_items">'+val+"</span>";prefCount++}));if(savePrefs>=4)prefs+='<span class="selected_items" style="background: none;">その他'+(savePrefs-3)+"</span>"}if($.isArray(jsonObj[key]["details"])){var detailCount=1;var saveDetails=jsonObj[key]["details"].length;jsonObj[key]["details"].forEach((function(val){if(detailCount<=6){details+='<span class="selected_items">'+val+"</span>";detailCount++}else{details+='<span class="selected_items" style="background: none;">'+val+"</span>"}}))}if(!breeds)breeds='<span class="selected_items">すべて</span>';if(!prefs)prefs='<span class="selected_items">すべて</span>';if(!details)details='<span class="selected_items">指定なし</span>';var html='<div class="searchRule_set">'+'<dl class="buttonWrap">'+"<dt>犬種</dt>"+"<dd>"+breeds+"</dd>"+"<dt>地域</dt>"+"<dd>"+prefs+"</dd>"+"<dt>条件</dt>"+"<dd>"+details+"</dd>"+"</dl>"+'<ul class="buttonWrap">'+'<li class="search"><a href="'+path+$.param(conditions)+'">検索</a></li>'+'<li class="delete"><a class="delete_conditions" value="'+key+'">削除</a></li>'+"</ul>"+"</div>";insertHtml=html+insertHtml}))}$(".searchRule_list").html(insertHtml)}function saveSearchCondition(){const isDog=location.pathname=="/dog"?"true":"false";const paramName=isDog!=="true"?"#form2_BreederSearchForm":"#form1_DogSearchForm";var params=$(paramName).serializeArray();var newParams={};Object.keys(params).forEach((function(key){if(key!=="0"){newParams[key]={name:saveNames[params[key]["name"]],value:params[key]["value"]}}}));var breedsText=$('input[name="db_id[]"]:checked').map((function(){return $(this).next("label").children("div").children("p").text()})).get();var prefText=$('[class="region pref_checkbox pref_checkbox"]:checked').map((function(){return $(this).next("label").text()})).get();var detailText=$('[class="s-f_condition selected-conditions"]').children("span").map((function(){return $(this).text()})).get();saveObj={breeds:breedsText,prefs:prefText,details:detailText,conditions:newParams,created:new Date};var newObj={};var readObj=JSON.parse(localStorage.getItem("conditions"));if(readObj!==null){var jsonCount=Object.keys(readObj).length;if(jsonCount===5){delete readObj[1];var itemsCount=1;Object.keys(readObj).forEach((function(key){newObj[itemsCount]=readObj[key];itemsCount++}));newObj[5]=saveObj}else if(jsonCount<5){var newCount=jsonCount+1;readObj[newCount]=saveObj;newObj=readObj}}else{newObj[1]=saveObj}localStorage.setItem(saveKey,JSON.stringify(newObj));loadConditions();window.alert("保存しました。")}$(".save_condition").click((function(){ajaxActionLogPost(getPage(),"save_dog_search_condition",{});saveSearchCondition()}));$(document).on("click",".delete_conditions",(function(){if(confirm("削除しますか？")){var target=$(this).attr("value");var count=1;var readObj=JSON.parse(localStorage.getItem(saveKey));var newObj={};Object.keys(readObj).forEach((function(key){if(key!==target){newObj[count]=readObj[key];count++}}));localStorage.setItem(saveKey,JSON.stringify(newObj));loadConditions()}else{return false}}));loadConditions()}));